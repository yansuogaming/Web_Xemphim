<IfModule mod_rewrite.c>
RewriteEngine on
RewriteRule ^ - [F,L]

# Redirect to HTTPS
RewriteCond %{HTTPS} !=on [NC]
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# Block specific user agents
RewriteCond %{HTTP_USER_AGENT} (IDM|wget|curl|ADM) [NC]
RewriteRule .* - [F,L]

# Block specific query strings
RewriteCond %{QUERY_STRING} (^|&)pp= [NC]
RewriteRule ^ - [F,L]

# Allow direct access to sitemap.xml
RewriteRule ^sitemap\.xml$ - [L]

# Rewrite rules for friendly URLs
RewriteRule ^$ /pages/home.php
RewriteRule ^phim/([^/]+)(/([^/]+))?$ /pages/info.php?url_phim=$1 [L]
RewriteRule ^danh-sach/([^/]+)(/([^/]+))?$ /pages/theloaiphim.php?theloai=$1 [L]
RewriteRule ^tim-kiem-phim/([^/]+)(/([^/]+))?$ /pages/search.php?ten=$1 [L]
RewriteRule ^xem/([^/]+)(/([^/]+))?$ /pages/xem.php?url_phim=$1&taphientai=$3 [L]
RewriteRule ^download/([^/]+)(/([^/]+))?$ /pages/download.php?url_phim=$1 [L]

# Maintenance page
RewriteRule ^baotri$ index.html

RewriteRule ^test$ test.html
</IfModule>

# Caching rules
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/gif A2592000
  ExpiresByType image/jpeg A2592000
  ExpiresByType image/jpg A2592000
  ExpiresByType image/png A2592000
  ExpiresByType image/x-icon A2592000
  ExpiresByType text/css A86400
  ExpiresByType text/javascript A86400
  ExpiresByType application/x-shockwave-flash A2592000

  <FilesMatch "\.(gif|jpe?g|png|ico|css|js|swf)$">
    Header set Cache-Control "public"
  </FilesMatch>
</IfModule>

# Compression rules
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain

  AddType x-font/otf .otf
  AddType x-font/ttf .ttf
  AddType x-font/eot .eot
  AddType x-font/woff .woff
  AddType image/x-icon .ico
</IfModule>
